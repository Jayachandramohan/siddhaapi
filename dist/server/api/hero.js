"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// model
var hero_1 = require("../models/hero");
/**
 * @class HerosApi
 */
var HerosApi = (function () {
    function HerosApi() {
    }
    /**
     * Create the api.
     * @static
     */
    HerosApi.create = function (router) {
        // DELETE
        router.delete("/heros/:id([0-9a-f]{24})", function (req, res, next) {
            new HerosApi().delete(req, res, next);
        });
        // GET
        router.get("/heros", function (req, res, next) {
            new HerosApi().list(req, res, next);
        });
        router.get("/heros/:id([0-9a-f]{24})", function (req, res, next) {
            new HerosApi().get(req, res, next);
        });
        // POST
        router.post("/heros", function (req, res, next) {
            new HerosApi().create(req, res, next);
        });
        // PUT
        router.put("/heros/:id([0-9a-f]{24})", function (req, res, next) {
            new HerosApi().update(req, res, next);
        });
    };
    /**
     * Create a new hero.
     * @param req {Request} The express request object.
     * @param res {Response} The express response object.
     * @param next {NextFunction} The next function to continue.
     */
    HerosApi.prototype.create = function (req, res, next) {
        // create hero
        var hero = new hero_1.Hero(req.body);
        hero.save().then(function (hero) {
            res.json(hero.toObject());
            next();
        }).catch(next);
    };
    /**
     * Delete a hero.
     * @param req {Request} The express request object.
     * @param res {Response} The express response object.
     * @param next {NextFunction} The next function to continue.
     */
    HerosApi.prototype.delete = function (req, res, next) {
        // verify the id parameter exists
        var PARAM_ID = "id";
        if (req.params[PARAM_ID] === undefined) {
            res.sendStatus(404);
            next();
            return;
        }
        // get id
        var id = req.params[PARAM_ID];
        // get hero
        hero_1.Hero.findById(id).then(function (hero) {
            // verify hero exists
            if (hero === null) {
                res.sendStatus(404);
                next();
                return;
            }
            hero.remove().then(function () {
                res.sendStatus(200);
                next();
            }).catch(next);
        }).catch(next);
    };
    /**
     * Get a hero.
     * @param req {Request} The express request object.
     * @param res {Response} The express response object.
     * @param next {NextFunction} The next function to continue.
     */
    HerosApi.prototype.get = function (req, res, next) {
        // verify the id parameter exists
        var PARAM_ID = "id";
        if (req.params[PARAM_ID] === undefined) {
            res.sendStatus(404);
            next();
            return;
        }
        // get id
        var id = req.params[PARAM_ID];
        // get hero
        hero_1.Hero.findById(id).then(function (hero) {
            // verify hero was found
            if (hero === null) {
                res.sendStatus(404);
                next();
                return;
            }
            // send json of hero object
            res.json(hero.toObject());
            next();
        }).catch(next);
    };
    /**
     * List all heros.
     * @param req {Request} The express request object.
     * @param res {Response} The express response object.
     * @param next {NextFunction} The next function to continue.
     */
    HerosApi.prototype.list = function (req, res, next) {
        // get heros
        hero_1.Hero.find().then(function (heros) {
            res.json(heros.map(function (hero) { return hero.toObject(); }));
            next();
        }).catch(next);
    };
    /**
     * Update a hero.
     * @param req {Request} The express request object.
     * @param res {Response} The express response object.
     * @param next {NextFunction} The next function to continue.
     */
    HerosApi.prototype.update = function (req, res, next) {
        var PARAM_ID = "id";
        // verify the id parameter exists
        if (req.params[PARAM_ID] === undefined) {
            res.sendStatus(404);
            next();
            return;
        }
        // get id
        var id = req.params[PARAM_ID];
        // get hero
        hero_1.Hero.findById(id).then(function (hero) {
            // verify hero was found
            if (hero === null) {
                res.sendStatus(404);
                next();
                return;
            }
            // save hero
            Object.assign(hero, req.body).save().then(function (hero) {
                res.json(hero.toObject());
                next();
            }).catch(next);
        }).catch(next);
    };
    return HerosApi;
}());
exports.HerosApi = HerosApi;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDLENBQUM7Z0JBQ3BCLElBQUksRUFBRSxDQUFDO2dCQUNQLE1BQU0sQ0FBQztZQUNULENBQUM7WUFFRCxZQUFZO1lBQ1osTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFDLElBQWU7Z0JBQ3hELEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7Z0JBQzFCLElBQUksRUFBRSxDQUFDO1lBQ1QsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2pCLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNqQixDQUFDO0lBRUgsZUFBQztBQUFELENBdEtBLEFBc0tDLElBQUE7QUF0S1ksNEJBQVEiLCJmaWxlIjoiYXBpL2hlcm8uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBleHByZXNzXG5pbXBvcnQgeyBOZXh0RnVuY3Rpb24sIFJlc3BvbnNlLCBSZXF1ZXN0LCBSb3V0ZXIgfSBmcm9tIFwiZXhwcmVzc1wiO1xuXG4vLyBtb2RlbFxuaW1wb3J0IHsgSGVybywgSGVyb01vZGVsIH0gZnJvbSBcIi4uL21vZGVscy9oZXJvXCI7XG5cbi8qKlxuICogQGNsYXNzIEhlcm9zQXBpXG4gKi9cbmV4cG9ydCBjbGFzcyBIZXJvc0FwaSB7XG5cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgYXBpLlxuICAgKiBAc3RhdGljXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGNyZWF0ZShyb3V0ZXI6IFJvdXRlcikge1xuICAgIC8vIERFTEVURVxuICAgIHJvdXRlci5kZWxldGUoXCIvaGVyb3MvOmlkKFswLTlhLWZdezI0fSlcIiwgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSA9PiB7XG4gICAgICBuZXcgSGVyb3NBcGkoKS5kZWxldGUocmVxLCByZXMsIG5leHQpO1xuICAgIH0pO1xuXG4gICAgLy8gR0VUXG4gICAgcm91dGVyLmdldChcIi9oZXJvc1wiLCAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pID0+IHtcbiAgICAgIG5ldyBIZXJvc0FwaSgpLmxpc3QocmVxLCByZXMsIG5leHQpO1xuICAgIH0pO1xuICAgIHJvdXRlci5nZXQoXCIvaGVyb3MvOmlkKFswLTlhLWZdezI0fSlcIiwgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSA9PiB7XG4gICAgICBuZXcgSGVyb3NBcGkoKS5nZXQocmVxLCByZXMsIG5leHQpO1xuICAgIH0pO1xuXG4gICAgLy8gUE9TVFxuICAgIHJvdXRlci5wb3N0KFwiL2hlcm9zXCIsIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikgPT4ge1xuICAgICAgbmV3IEhlcm9zQXBpKCkuY3JlYXRlKHJlcSwgcmVzLCBuZXh0KTtcbiAgICB9KTtcblxuICAgIC8vIFBVVFxuICAgIHJvdXRlci5wdXQoXCIvaGVyb3MvOmlkKFswLTlhLWZdezI0fSlcIiwgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSA9PiB7XG4gICAgICBuZXcgSGVyb3NBcGkoKS51cGRhdGUocmVxLCByZXMsIG5leHQpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBoZXJvLlxuICAgKiBAcGFyYW0gcmVxIHtSZXF1ZXN0fSBUaGUgZXhwcmVzcyByZXF1ZXN0IG9iamVjdC5cbiAgICogQHBhcmFtIHJlcyB7UmVzcG9uc2V9IFRoZSBleHByZXNzIHJlc3BvbnNlIG9iamVjdC5cbiAgICogQHBhcmFtIG5leHQge05leHRGdW5jdGlvbn0gVGhlIG5leHQgZnVuY3Rpb24gdG8gY29udGludWUuXG4gICAqL1xuICBwdWJsaWMgY3JlYXRlKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSB7XG4gICAgLy8gY3JlYXRlIGhlcm9cbiAgICBjb25zdCBoZXJvID0gbmV3IEhlcm8ocmVxLmJvZHkpO1xuICAgIGhlcm8uc2F2ZSgpLnRoZW4oaGVybyA9PiB7XG4gICAgICByZXMuanNvbihoZXJvLnRvT2JqZWN0KCkpO1xuICAgICAgbmV4dCgpO1xuICAgIH0pLmNhdGNoKG5leHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZSBhIGhlcm8uXG4gICAqIEBwYXJhbSByZXEge1JlcXVlc3R9IFRoZSBleHByZXNzIHJlcXVlc3Qgb2JqZWN0LlxuICAgKiBAcGFyYW0gcmVzIHtSZXNwb25zZX0gVGhlIGV4cHJlc3MgcmVzcG9uc2Ugb2JqZWN0LlxuICAgKiBAcGFyYW0gbmV4dCB7TmV4dEZ1bmN0aW9ufSBUaGUgbmV4dCBmdW5jdGlvbiB0byBjb250aW51ZS5cbiAgICovXG4gIHB1YmxpYyBkZWxldGUocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pIHtcbiAgICAvLyB2ZXJpZnkgdGhlIGlkIHBhcmFtZXRlciBleGlzdHNcbiAgICBjb25zdCBQQVJBTV9JRDogc3RyaW5nID0gXCJpZFwiO1xuICAgIGlmIChyZXEucGFyYW1zW1BBUkFNX0lEXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXMuc2VuZFN0YXR1cyg0MDQpO1xuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGdldCBpZFxuICAgIGNvbnN0IGlkOiBzdHJpbmcgPSByZXEucGFyYW1zW1BBUkFNX0lEXTtcblxuICAgICAgLy8gZ2V0IGhlcm9cbiAgICAgIEhlcm8uZmluZEJ5SWQoaWQpLnRoZW4oaGVybyA9PiB7XG5cbiAgICAgIC8vIHZlcmlmeSBoZXJvIGV4aXN0c1xuICAgICAgaWYgKGhlcm8gPT09IG51bGwpIHtcbiAgICAgICAgcmVzLnNlbmRTdGF0dXMoNDA0KTtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGhlcm8ucmVtb3ZlKCkudGhlbigoKSA9PiB7XG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDIwMCk7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0pLmNhdGNoKG5leHQpO1xuICAgIH0pLmNhdGNoKG5leHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIGhlcm8uXG4gICAqIEBwYXJhbSByZXEge1JlcXVlc3R9IFRoZSBleHByZXNzIHJlcXVlc3Qgb2JqZWN0LlxuICAgKiBAcGFyYW0gcmVzIHtSZXNwb25zZX0gVGhlIGV4cHJlc3MgcmVzcG9uc2Ugb2JqZWN0LlxuICAgKiBAcGFyYW0gbmV4dCB7TmV4dEZ1bmN0aW9ufSBUaGUgbmV4dCBmdW5jdGlvbiB0byBjb250aW51ZS5cbiAgICovXG4gIHB1YmxpYyBnZXQocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pIHtcbiAgICAvLyB2ZXJpZnkgdGhlIGlkIHBhcmFtZXRlciBleGlzdHNcbiAgICBjb25zdCBQQVJBTV9JRDogc3RyaW5nID0gXCJpZFwiO1xuICAgIGlmIChyZXEucGFyYW1zW1BBUkFNX0lEXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXMuc2VuZFN0YXR1cyg0MDQpO1xuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGdldCBpZFxuICAgIGNvbnN0IGlkOiBzdHJpbmcgPSByZXEucGFyYW1zW1BBUkFNX0lEXTtcblxuICAgIC8vIGdldCBoZXJvXG4gICAgICBIZXJvLmZpbmRCeUlkKGlkKS50aGVuKGhlcm8gPT4ge1xuXG4gICAgICAvLyB2ZXJpZnkgaGVybyB3YXMgZm91bmRcbiAgICAgIGlmIChoZXJvID09PSBudWxsKSB7XG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDQwNCk7XG4gICAgICAgIG5leHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBzZW5kIGpzb24gb2YgaGVybyBvYmplY3RcbiAgICAgIHJlcy5qc29uKGhlcm8udG9PYmplY3QoKSk7XG4gICAgICBuZXh0KCk7XG4gICAgfSkuY2F0Y2gobmV4dCk7XG4gIH1cblxuICAvKipcbiAgICogTGlzdCBhbGwgaGVyb3MuXG4gICAqIEBwYXJhbSByZXEge1JlcXVlc3R9IFRoZSBleHByZXNzIHJlcXVlc3Qgb2JqZWN0LlxuICAgKiBAcGFyYW0gcmVzIHtSZXNwb25zZX0gVGhlIGV4cHJlc3MgcmVzcG9uc2Ugb2JqZWN0LlxuICAgKiBAcGFyYW0gbmV4dCB7TmV4dEZ1bmN0aW9ufSBUaGUgbmV4dCBmdW5jdGlvbiB0byBjb250aW51ZS5cbiAgICovXG4gIHB1YmxpYyBsaXN0KHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSB7XG4gICAgLy8gZ2V0IGhlcm9zXG4gICAgSGVyby5maW5kKCkudGhlbihoZXJvcyA9PiB7XG4gICAgICByZXMuanNvbihoZXJvcy5tYXAoaGVybyA9PiBoZXJvLnRvT2JqZWN0KCkpKTtcbiAgICAgIG5leHQoKTtcbiAgICB9KS5jYXRjaChuZXh0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYSBoZXJvLlxuICAgKiBAcGFyYW0gcmVxIHtSZXF1ZXN0fSBUaGUgZXhwcmVzcyByZXF1ZXN0IG9iamVjdC5cbiAgICogQHBhcmFtIHJlcyB7UmVzcG9uc2V9IFRoZSBleHByZXNzIHJlc3BvbnNlIG9iamVjdC5cbiAgICogQHBhcmFtIG5leHQge05leHRGdW5jdGlvbn0gVGhlIG5leHQgZnVuY3Rpb24gdG8gY29udGludWUuXG4gICAqL1xuICBwdWJsaWMgdXBkYXRlKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSB7XG4gICAgY29uc3QgUEFSQU1fSUQ6IHN0cmluZyA9IFwiaWRcIjtcblxuICAgIC8vIHZlcmlmeSB0aGUgaWQgcGFyYW1ldGVyIGV4aXN0c1xuICAgIGlmIChyZXEucGFyYW1zW1BBUkFNX0lEXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXMuc2VuZFN0YXR1cyg0MDQpO1xuICAgICAgbmV4dCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGdldCBpZFxuICAgIGNvbnN0IGlkOiBzdHJpbmcgPSByZXEucGFyYW1zW1BBUkFNX0lEXTtcblxuICAgIC8vIGdldCBoZXJvXG4gICAgSGVyby5maW5kQnlJZChpZCkudGhlbihoZXJvID0+IHtcblxuICAgICAgLy8gdmVyaWZ5IGhlcm8gd2FzIGZvdW5kXG4gICAgICBpZiAoaGVybyA9PT0gbnVsbCkge1xuICAgICAgICByZXMuc2VuZFN0YXR1cyg0MDQpO1xuICAgICAgICBuZXh0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gc2F2ZSBoZXJvXG4gICAgICBPYmplY3QuYXNzaWduKGhlcm8sIHJlcS5ib2R5KS5zYXZlKCkudGhlbigoaGVybzogSGVyb01vZGVsKSA9PiB7XG4gICAgICAgIHJlcy5qc29uKGhlcm8udG9PYmplY3QoKSk7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0pLmNhdGNoKG5leHQpO1xuICAgIH0pLmNhdGNoKG5leHQpO1xuICB9XG5cbn0iXX0=
